<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weekly Work Scheduler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px auto;
      max-width: 1200px;
      padding: 0 10px;
      background-color: #f4f4f4;
      color: #333;
      transition: background 0.3s, color 0.3s;
    }
    body.dark { background-color: #121212; color: #e0e0e0; }
    h1, h2 { text-align: left; }
    input, select, button { margin: 5px 0; }
    section { background: white; padding: 15px; margin-bottom: 20px; border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: background 0.3s, color 0.3s; }
    body.dark section { background: #1f1f1f; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; display: block; overflow-x: auto; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; min-width: 50px; transition: background 0.3s, color 0.3s; }
    th { background-color: #f2f2f2; }
    body.dark th { background-color: #2c2c2c; }
    tbody tr:nth-child(even) { background-color: #f9f9f9; }
    body.dark tbody tr:nth-child(even) { background-color: #1a1a1a; }
    tbody tr:hover { background-color: #e6f7ff; }
    body.dark tbody tr:hover { background-color: #333333; }
    button { padding: 6px 12px; border-radius: 4px; border: none; background-color: #007BFF; color: white; cursor: pointer; transition: background 0.2s; }
    button:hover { background-color: #0056b3; }
    .remove-btn { background-color: red; color: white; border: none; padding: 3px 6px; border-radius: 3px; }
    .remove-btn:hover { background-color: darkred; }
    .task-label { margin-right: 5px; }
    .schedule-table td.kitchen-task { background-color: #d1e7dd; }
    .schedule-table td.work-task { background-color: #f8d7da; }
    @media (max-width: 768px) { table { display: block; overflow-x: auto; } }
  </style>
</head>
<body>
  <h1>Weekly Work Scheduler</h1>

  <section id="people-section">
    <h2>People</h2>
    <div class="input-group">
      <input type="text" id="person-name" placeholder="Enter name">
      <select id="person-gender">
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <button id="add-person-btn">Add Person</button>
    </div>
    <ul id="people-list"></ul>
  </section>

  <section id="kitchen-section">
    <h2>Kitchen Tasks</h2>
    <div class="input-group">
      <input type="text" id="kitchen-task-name" placeholder="Enter task">
      <input type="number" id="kitchen-task-count" placeholder="People needed" min="1" value="1">
      <button id="add-kitchen-task-btn">Add Task</button>
    </div>
    <table id="kitchen-task-table">
      <thead>
        <tr>
          <th>Task</th>
          <th>People Needed</th>
          <th>Days Needed</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section id="work-section">
    <h2>Work Duties</h2>
    <div class="input-group">
      <input type="text" id="work-task-name" placeholder="Enter task">
      <input type="number" id="work-task-count" placeholder="People needed" min="1" value="1">
      <select id="work-task-gender">
        <option value="Any">Any</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <button id="add-work-task-btn">Add Task</button>
    </div>
    <table id="work-task-table">
      <thead>
        <tr>
          <th>Task</th>
          <th>People Needed</th>
          <th>Days Needed</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section id="availability-section">
    <h2>Availability</h2>
    <table id="availability-table">
      <thead>
        <tr>
          <th>Person</th>
          <th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <div class="input-group">
    <button id="generate-btn">Generate Schedule</button>
    <button id="clear-btn">Clear Schedule</button>
    <button id="download-btn">Download CSV</button>
    <button id="darkmode-btn">Toggle Dark Mode</button>
  </div>

  <section id="schedule-section">
    <h2>Generated Kitchen Schedule</h2>
    <table id="kitchen-schedule-table" class="schedule-table"></table>

    <h2>Generated Work Duties Schedule</h2>
    <table id="work-schedule-table" class="schedule-table"></table>
  </section>

  <script>
    // ====== All JavaScript logic merged here ======
    let peopleList = JSON.parse(localStorage.getItem("peopleList")) || [];
    let kitchenTasks = JSON.parse(localStorage.getItem("kitchenTasks")) || [];
    let workTasks = JSON.parse(localStorage.getItem("workTasks")) || [];
    let availability = JSON.parse(localStorage.getItem("availability")) || {};

    const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
    const kitchenSubTasks = ["Breakfast","Lunch","Lunch Dishes","Dinner","Dinner Dishes"];
    const allSlots = [...kitchenSubTasks, "Work Duty"];

    const personInput = document.getElementById("person-name");
    const personGender = document.getElementById("person-gender");
    const addPersonBtn = document.getElementById("add-person-btn");
    const peopleUl = document.getElementById("people-list");

    const kitchenTaskInput = document.getElementById("kitchen-task-name");
    const kitchenTaskCount = document.getElementById("kitchen-task-count");
    const addKitchenTaskBtn = document.getElementById("add-kitchen-task-btn");
    const kitchenTaskTable = document.getElementById("kitchen-task-table").querySelector("tbody");

    const workTaskInput = document.getElementById("work-task-name");
    const workTaskCount = document.getElementById("work-task-count");
    const workTaskGender = document.getElementById("work-task-gender");
    const addWorkTaskBtn = document.getElementById("add-work-task-btn");
    const workTaskTable = document.getElementById("work-task-table").querySelector("tbody");

    const availabilityTable = document.getElementById("availability-table");
    const availabilityTbody = availabilityTable.querySelector("tbody");

    const generateBtn = document.getElementById("generate-btn");
    const clearBtn = document.getElementById("clear-btn");
    const downloadBtn = document.getElementById("download-btn");
    const darkmodeBtn = document.getElementById("darkmode-btn");

    const kitchenScheduleTable = document.getElementById("kitchen-schedule-table");
    const workScheduleTable = document.getElementById("work-schedule-table");

    function saveData(){
      localStorage.setItem("peopleList", JSON.stringify(peopleList));
      localStorage.setItem("kitchenTasks", JSON.stringify(kitchenTasks));
      localStorage.setItem("workTasks", JSON.stringify(workTasks));
      localStorage.setItem("availability", JSON.stringify(availability));
    }

    function shuffle(array){ return array.sort(()=>Math.random()-0.5); }

    function ensureAvailabilityStructure(){
      peopleList.forEach(p=>{
        if(!availability[p.name]) availability[p.name] = {};
        days.forEach(day=>{
          if(!availability[p.name][day]) availability[p.name][day] = {};
          allSlots.forEach(slot=>{
            if(availability[p.name][day][slot] === undefined) availability[p.name][day][slot] = true;
          });
        });
      });
    }

    const slotEmoji = {
      "Breakfast":"ðŸ³",
      "Lunch":"â˜€ï¸",
      "Lunch Dishes":"ðŸ½ï¸",
      "Dinner":"ðŸŒ™",
      "Dinner Dishes":"ðŸ§¼",
      "Work Duty":"ðŸ’¼"
    };

    // ---- People ----
    addPersonBtn.addEventListener("click", ()=>{
      const name = personInput.value.trim();
      const gender = personGender.value;
      if(!name) return alert("Name required");
      if(peopleList.find(p=>p.name===name)) return alert("Person already exists");
      peopleList.push({name, gender});
      availability[name] = availability[name] || {};
      days.forEach(d=>{
        availability[name][d] = availability[name][d] || {};
        allSlots.forEach(s => { if(availability[name][d][s] === undefined) availability[name][d][s] = true; });
      });
      saveData();
      renderPeople();
      renderAvailability();
      personInput.value = "";
    });

    function removePerson(name){
      if(!confirm(`Remove ${name}?`)) return;
      const idx = peopleList.findIndex(p=>p.name===name);
      if(idx>-1){
        peopleList.splice(idx,1);
        delete availability[name];
        saveData();
        renderPeople();
        renderAvailability();
      }
    }

    function renderPeople(){
      peopleUl.innerHTML = "";
      peopleList.forEach(p=>{
        const li = document.createElement("li");
        li.textContent = `${p.name} (${p.gender}) `;
        const btn = document.createElement("button");
        btn.textContent = "Remove"; btn.className = "remove-btn";
        btn.onclick = ()=> removePerson(p.name);
        li.appendChild(btn);
        peopleUl.appendChild(li);
      });
    }

    function renderTasks(taskArray, tableBody){
      tableBody.innerHTML = "";
      taskArray.forEach((task, idx)=>{
        const tr = document.createElement("tr");
        const nameTd = document.createElement("td"); nameTd.textContent = task.name; tr.appendChild(nameTd);

        const countTd = document.createElement("td");
        const countInput = document.createElement("input");
        countInput.type="number"; countInput.value=task.count; countInput.min=1;
        countInput.onchange = ()=>{ task.count = parseInt(countInput.value) || 1; saveData();}
        countTd.appendChild(countInput); tr.appendChild(countTd);

        const daysTd = document.createElement("td");
        days.forEach(d=>{
          const label = document.createElement("label"); label.className = "task-label";
          const cb = document.createElement("input"); cb.type="checkbox";
          cb.checked = !!task.days[d];
          cb.onchange = ()=>{ task.days[d] = cb.checked; saveData();}
          label.appendChild(cb); label.appendChild(document.createTextNode(d[0]));
          daysTd.appendChild(label);
        });
        tr.appendChild(daysTd);

        const removeTd = document.createElement("td");
        const btn = document.createElement("button"); btn.textContent="Remove"; btn.className="remove-btn";
        btn.onclick = ()=>{ taskArray.splice(idx,1); renderTasks(taskArray, tableBody); saveData(); };
        removeTd.appendChild(btn); tr.appendChild(removeTd);

        tableBody.appendChild(tr);
      });
    }

    addKitchenTaskBtn.addEventListener("click", ()=>{
      const name = kitchenTaskInput.value.trim();
      const count = parseInt(kitchenTaskCount.value) || 1;
      if(!name) return alert("Task name required");
      const taskObj = { name, count, days: {} };
      days.forEach(d=>taskObj.days[d]=true);
      kitchenTasks.push(taskObj);
      saveData();
      renderTasks(kitchenTasks, kitchenTaskTable);
      kitchenTaskInput.value=""; kitchenTaskCount.value=1;
    });

    addWorkTaskBtn.addEventListener("click", ()=>{
      const name = workTaskInput.value.trim();
      const count = parseInt(workTaskCount.value) || 1;
      const genderReq = workTaskGender.value;
      if(!name) return alert("Task name required");
      const taskObj = { name, count, days: {} , genderRequired: genderReq};
      days.forEach(d=>taskObj.days[d]=false);
      workTasks.push(taskObj);
      saveData();
      renderTasks(workTasks, workTaskTable);
      workTaskInput.value=""; workTaskCount.value=1; workTaskGender.value="Any";
    });

    // ---- Availability ----
    let modalEl = null;

    function renderAvailability(){
      ensureAvailabilityStructure();
      let thead = availabilityTable.querySelector("thead");
      thead.innerHTML = "";
      const hdrRow = thead.insertRow();
      hdrRow.insertCell().textContent = "Person";
      days.forEach(d=> hdrRow.insertCell().textContent = d);

      availabilityTbody.innerHTML = "";
      peopleList.forEach(person=>{
        const tr = document.createElement("tr");
        const nameCell = document.createElement("td");
        nameCell.textContent = person.name;
        tr.appendChild(nameCell);

        days.forEach(day=>{
          const td = document.createElement("td");
          td.className = "avail-cell";
          td.style.cursor = "pointer";
          td.style.minWidth = "80px";
          td.style.padding = "6px";
          td.style.textAlign = "center";

          const slots = allSlots.filter(s => !!availability[person.name][day][s]);
          td.innerHTML = slots.map(s => `<span title="${s}" style="margin:0 2px; font-size:16px;">${slotEmoji[s]||s[0]}</span>`).join("");

          td.onclick = ()=>{ openAvailabilityModal(person.name, day, td); };

          tr.appendChild(td);
        });

        availabilityTbody.appendChild(tr);
      });
    }

    function openAvailabilityModal(personName, day, anchorCell){
      closeAvailabilityModal();
      modalEl = document.createElement("div");
      modalEl.style.position = "fixed";
      modalEl.style.zIndex = 9999;
      modalEl.style.background = (document.body.classList.contains("dark") ? "#1e1e1e" : "#ffffff");
      modalEl.style.color = (document.body.classList.contains("dark") ? "#e0e0e0" : "#222");
      modalEl.style.border = "1px solid rgba(0,0,0,0.12)";
      modalEl.style.boxShadow = "0 6px 18px rgba(0,0,0,0.12)";
      modalEl.style.padding = "10px";
      modalEl.style.borderRadius = "8px";
      modalEl.style.minWidth = "220px";

      const title = document.createElement("div");
      title.style.fontWeight = "600"; title.style.marginBottom = "6px";
      title.textContent = `${personName} â€” ${day}`;
      modalEl.appendChild(title);

      const form = document.createElement("div");
      form.style.display = "grid";
      form.style.gridTemplateColumns = "1fr 1fr";
      form.style.gap = "6px";

      allSlots.forEach(slot=>{
        const label = document.createElement("label");
        label.style.display = "flex"; label.style.alignItems = "center"; label.style.gap = "6px"; label.style.cursor = "pointer";
        const cb = document.createElement("input");
        cb.type = "checkbox"; cb.checked = !!availability[personName][day][slot]; cb.dataset.slot = slot;
        const emojiSpan = document.createElement("span"); emojiSpan.textContent = slotEmoji[slot] || slot[0];
        const text = document.createElement("span"); text.textContent = slot; text.style.fontSize = "13px";
        label.appendChild(cb); label.appendChild(emojiSpan); label.appendChild(text);

        cb.onchange = ()=>{
          const checked = cb.checked;
          availability[personName][day][slot] = checked;
          if(slot === "Lunch Dishes"){ availability[personName][day]["Work Duty"] = checked; }
          else if(slot === "Work Duty"){ availability[personName][day]["Lunch Dishes"] = checked; }
          modalEl.querySelectorAll("input[type=checkbox]").forEach(other=>{ const s = other.dataset.slot; other.checked = !!availability[personName][day][s]; });
          saveData();
        };

        form.appendChild(label);
      });

      modalEl.appendChild(form);

      const btnRow = document.createElement("div");
      btnRow.style.display = "flex"; btnRow.style.justifyContent = "flex-end"; btnRow.style.gap = "8px"; btnRow.style.marginTop = "8px";

      const doneBtn = document.createElement("button"); doneBtn.textContent = "Done"; doneBtn.style.padding="6px 10px"; doneBtn.style.borderRadius="6px";
      doneBtn.onclick = ()=>{ saveData(); renderAvailability(); closeAvailabilityModal(); };
      btnRow.appendChild(doneBtn);

      const cancelBtn = document.createElement("button"); cancelBtn.textContent = "Cancel"; cancelBtn.style.padding="6px 10px"; cancelBtn.style.borderRadius="6px"; cancelBtn.style.background="#ddd";
      cancelBtn.onclick = ()=>{ closeAvailabilityModal(); };
      btnRow.appendChild(cancelBtn);

      modalEl.appendChild(btnRow);
      document.body.appendChild(modalEl);

      const

</html>
